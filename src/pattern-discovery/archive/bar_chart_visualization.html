<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Betting Patterns Bar Chart</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .filter-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .filter-group label {
            font-weight: bold;
            font-size: 14px;
        }
        
        .filter-group select, .filter-group input {
            padding: 5px 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .stats {
            text-align: center;
            font-size: 14px;
            color: #666;
        }
        
        .chart-container {
            border: 1px solid #ddd;
            border-radius: 5px;
            overflow: hidden;
            background: white;
        }
        
        .bar {
            cursor: pointer;
            transition: opacity 0.3s;
        }
        
        .bar:hover {
            opacity: 0.8;
        }
        
        .bar-profitable {
            fill: #2e7d32;
        }
        
        .bar-break-even {
            fill: #1976d2;
        }
        
        .bar-loss {
            fill: #d32f2f;
        }
        
        .axis text {
            font-size: 12px;
            font-family: Arial, sans-serif;
        }
        
        .axis-label {
            font-size: 14px;
            font-weight: bold;
            text-anchor: middle;
        }
        
        .tooltip {
            position: absolute;
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 12px;
            border-radius: 5px;
            font-size: 12px;
            pointer-events: none;
            z-index: 1000;
            display: none;
            max-width: 300px;
        }
        
        .legend {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 30px;
            font-size: 14px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 3px;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            overflow-y: auto;
        }
        
        .modal-content {
            background-color: #fefefe;
            margin: 2% auto;
            padding: 0;
            border: none;
            border-radius: 8px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        
        .modal-header {
            background: linear-gradient(135deg, #1976d2, #1565c0);
            color: white;
            padding: 20px;
            border-radius: 8px 8px 0 0;
            position: relative;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .close {
            color: white;
            float: right;
            font-size: 28px;
            font-weight: bold;
            position: absolute;
            right: 20px;
            top: 15px;
            cursor: pointer;
        }
        
        .close:hover {
            opacity: 0.7;
        }
        
        .detail-section {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
            border-left: 4px solid #1976d2;
        }
        
        .detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }
        
        .detail-item {
            background: white;
            padding: 12px;
            border-radius: 4px;
            border: 1px solid #e0e0e0;
        }
        
        .detail-label {
            font-weight: bold;
            color: #555;
            font-size: 12px;
            text-transform: uppercase;
            margin-bottom: 5px;
        }
        
        .detail-value {
            font-size: 16px;
            color: #333;
        }
        
        .strategy-factors {
            background: #e8f5e8;
            border-left-color: #4caf50;
        }
        
        .calculation-breakdown {
            background: #fff3e0;
            border-left-color: #ff9800;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä Betting Patterns Performance Chart</h1>
            <p>Patterns ranked by ROI performance with filtering and detailed information</p>
        </div>
        
        <div class="controls">
            <div class="filter-group">
                <label>Show:</label>
                <select id="performance-filter">
                    <option value="all">All Patterns</option>
                    <option value="profitable" selected>Profitable Only (ROI > 0%)</option>
                    <option value="excellent">Excellent (ROI > 50%)</option>
                    <option value="good">Good (ROI > 20%)</option>
                    <option value="modest">Modest (ROI > 10%)</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label>Min Bets:</label>
                <input type="number" id="min-bets" value="5" min="1" max="100">
            </div>
            
            <div class="filter-group">
                <label>Sort by:</label>
                <select id="sort-by">
                    <option value="roi" selected>ROI</option>
                    <option value="profit">Total Profit</option>
                    <option value="bets">Number of Bets</option>
                    <option value="winRate">Win Rate</option>
                </select>
            </div>
            
            <div class="stats">
                <span id="current-stats">Loading...</span>
            </div>
        </div>
        
        <div class="chart-container">
            <svg id="chart" width="1560" height="600"></svg>
        </div>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: #2e7d32;"></div>
                <span>Profitable (ROI > 0%)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #1976d2;"></div>
                <span>Break Even (-5% to 0%)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #d32f2f;"></div>
                <span>Loss (ROI < -5%)</span>
            </div>
        </div>
        
        <!-- Data Table -->
        <div style="margin-top: 30px;">
            <h3>üìã Detailed Pattern Data</h3>
            <p style="color: #666; margin-bottom: 20px;">
                Complete breakdown of the patterns shown in the chart above. 
                <strong>Note:</strong> Simulation uses $100 stake per bet - adjust expectations for real betting.
            </p>
            <div style="overflow-x: auto; border: 1px solid #ddd; border-radius: 5px;">
                <table id="data-table" style="width: 100%; border-collapse: collapse; font-size: 13px;">
                    <thead style="background: #f8f9fa; font-weight: bold;">
                        <tr>
                            <th style="padding: 12px 8px; border-bottom: 2px solid #ddd; text-align: left;">Rank</th>
                            <th style="padding: 12px 8px; border-bottom: 2px solid #ddd; text-align: left; min-width: 250px;">Pattern Name</th>
                            <th style="padding: 12px 8px; border-bottom: 2px solid #ddd; text-align: right;">ROI %</th>
                            <th style="padding: 12px 8px; border-bottom: 2px solid #ddd; text-align: right;">Bets</th>
                            <th style="padding: 12px 8px; border-bottom: 2px solid #ddd; text-align: right;">Wins</th>
                            <th style="padding: 12px 8px; border-bottom: 2px solid #ddd; text-align: right;">Losses</th>
                            <th style="padding: 12px 8px; border-bottom: 2px solid #ddd; text-align: right;">Win %</th>
                            <th style="padding: 12px 8px; border-bottom: 2px solid #ddd; text-align: right;">Avg Odds</th>
                            <th style="padding: 12px 8px; border-bottom: 2px solid #ddd; text-align: right;">Total Stake</th>
                            <th style="padding: 12px 8px; border-bottom: 2px solid #ddd; text-align: right;">Total Payout</th>
                            <th style="padding: 12px 8px; border-bottom: 2px solid #ddd; text-align: right;">Profit</th>
                            <th style="padding: 12px 8px; border-bottom: 2px solid #ddd; text-align: right;">Stake/Bet</th>
                        </tr>
                    </thead>
                    <tbody id="table-body">
                        <!-- Table content will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <div class="tooltip" id="tooltip"></div>
        
        <!-- Pattern Details Modal -->
        <div id="pattern-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <span class="close" id="modal-close">&times;</span>
                    <h2 id="modal-title">Pattern Details</h2>
                    <p id="modal-subtitle" style="margin: 5px 0 0 0; opacity: 0.9;"></p>
                </div>
                <div class="modal-body" id="modal-body">
                    <!-- Content will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <script>
        class BarChart {
            constructor() {
                this.data = null;
                this.filteredData = null;
                this.svg = d3.select("#chart");
                this.width = 1560;
                this.height = 600;
                this.margin = { top: 40, right: 40, bottom: 100, left: 80 };
                this.chartWidth = this.width - this.margin.left - this.margin.right;
                this.chartHeight = this.height - this.margin.top - this.margin.bottom;
                this.tooltip = d3.select("#tooltip");
                
                this.init();
            }
            
            async init() {
                try {
                    const response = await fetch('./results/clean_discovery.json');
                    const dataWrapper = await response.json();
                    this.data = dataWrapper.patterns || dataWrapper;
                    
                    console.log('üìä Loaded data:', this.data.length, 'patterns');
                    
                                    this.setupChart();
                this.setupControls();
                this.setupModal();
                this.filterAndRender();
                } catch (error) {
                    console.error('Error loading data:', error);
                    document.getElementById('current-stats').textContent = 'Error loading data: ' + error.message;
                }
            }
            
            setupChart() {
                this.chartGroup = this.svg.append("g")
                    .attr("transform", `translate(${this.margin.left},${this.margin.top})`);
                
                // X axis
                this.xAxisGroup = this.chartGroup.append("g")
                    .attr("transform", `translate(0,${this.chartHeight})`);
                
                // Y axis
                this.yAxisGroup = this.chartGroup.append("g");
                
                // Axis labels
                this.svg.append("text")
                    .attr("class", "axis-label")
                    .attr("transform", "rotate(-90)")
                    .attr("y", 30)
                    .attr("x", -this.height / 2)
                    .text("ROI (%)");
                
                this.svg.append("text")
                    .attr("class", "axis-label")
                    .attr("x", this.width / 2)
                    .attr("y", this.height - 20)
                    .text("Betting Patterns");
            }
            
            setupControls() {
                ['performance-filter', 'min-bets', 'sort-by'].forEach(id => {
                    document.getElementById(id).addEventListener('change', () => this.filterAndRender());
                });
            }
            
            filterAndRender() {
                const performanceFilter = document.getElementById('performance-filter').value;
                const minBets = parseInt(document.getElementById('min-bets').value);
                const sortBy = document.getElementById('sort-by').value;
                
                // Apply filters
                let filtered = this.data.filter(d => d.bets >= minBets);
                
                switch (performanceFilter) {
                    case 'profitable':
                        filtered = filtered.filter(d => d.roi > 0);
                        break;
                    case 'excellent':
                        filtered = filtered.filter(d => d.roi > 50);
                        break;
                    case 'good':
                        filtered = filtered.filter(d => d.roi > 20);
                        break;
                    case 'modest':
                        filtered = filtered.filter(d => d.roi > 10);
                        break;
                }
                
                // Sort data
                filtered.sort((a, b) => {
                    switch (sortBy) {
                        case 'roi':
                            return b.roi - a.roi;
                        case 'profit':
                            return b.totalProfit - a.totalProfit;
                        case 'bets':
                            return b.bets - a.bets;
                        case 'winRate':
                            return b.winRate - a.winRate;
                        default:
                            return b.roi - a.roi;
                    }
                });
                
                this.filteredData = filtered.slice(0, 50); // Show top 50
                this.updateStats();
                this.render();
                this.updateTable();
            }
            
            updateStats() {
                const profitable = this.filteredData.filter(d => d.roi > 0).length;
                const totalProfit = this.filteredData.reduce((sum, d) => sum + d.totalProfit, 0);
                const avgROI = this.filteredData.length > 0 ? 
                    this.filteredData.reduce((sum, d) => sum + d.roi, 0) / this.filteredData.length : 0;
                
                document.getElementById('current-stats').innerHTML = `
                    Showing ${this.filteredData.length} patterns | 
                    ${profitable} profitable | 
                    Avg ROI: ${avgROI.toFixed(1)}% | 
                    Total Profit: $${totalProfit.toLocaleString()}
                `;
            }
            
            render() {
                // Clear previous chart
                this.chartGroup.selectAll(".bar").remove();
                
                if (this.filteredData.length === 0) {
                    this.chartGroup.append("text")
                        .attr("x", this.chartWidth / 2)
                        .attr("y", this.chartHeight / 2)
                        .attr("text-anchor", "middle")
                        .attr("font-size", "16px")
                        .attr("fill", "#666")
                        .text("No patterns match the current filters");
                    return;
                }
                
                // Set up scales
                const xScale = d3.scaleBand()
                    .domain(this.filteredData.map((d, i) => i))
                    .range([0, this.chartWidth])
                    .padding(0.1);
                
                const yScale = d3.scaleLinear()
                    .domain(d3.extent(this.filteredData, d => d.roi))
                    .nice()
                    .range([this.chartHeight, 0]);
                
                // Create bars
                this.chartGroup.selectAll(".bar")
                    .data(this.filteredData)
                    .enter()
                    .append("rect")
                    .attr("class", d => {
                        if (d.roi > 0) return "bar bar-profitable";
                        if (d.roi >= -5) return "bar bar-break-even";
                        return "bar bar-loss";
                    })
                    .attr("x", (d, i) => xScale(i))
                    .attr("y", d => d.roi >= 0 ? yScale(d.roi) : yScale(0))
                    .attr("width", xScale.bandwidth())
                    .attr("height", d => Math.abs(yScale(d.roi) - yScale(0)))
                    .on("mouseover", (event, d) => this.showTooltip(event, d))
                    .on("mouseout", () => this.hideTooltip())
                    .on("click", (event, d) => this.showPatternDetails(d));
                
                // Update axes
                this.xAxisGroup.call(d3.axisBottom(xScale)
                    .tickFormat((d, i) => {
                        const pattern = this.filteredData[i];
                        if (!pattern) return '';
                        let name = pattern.name.replace(/_/g, ' ');
                        return name.length > 20 ? name.substring(0, 17) + '...' : name;
                    }))
                    .selectAll("text")
                    .style("text-anchor", "end")
                    .attr("dx", "-.8em")
                    .attr("dy", ".15em")
                    .attr("transform", "rotate(-45)");
                
                this.yAxisGroup.call(d3.axisLeft(yScale).tickFormat(d => d + '%'));
                
                // Add zero line
                this.chartGroup.append("line")
                    .attr("x1", 0)
                    .attr("x2", this.chartWidth)
                    .attr("y1", yScale(0))
                    .attr("y2", yScale(0))
                    .attr("stroke", "#666")
                    .attr("stroke-width", 1)
                    .attr("stroke-dasharray", "3,3");
            }
            
            showTooltip(event, d) {
                this.tooltip
                    .style("display", "block")
                    .style("left", (event.pageX + 10) + "px")
                    .style("top", (event.pageY - 10) + "px")
                    .html(`
                        <strong>${d.name.replace(/_/g, ' ‚Üí ')}</strong><br/>
                        <strong>ROI:</strong> ${d.roi.toFixed(2)}%<br/>
                        <strong>Total Profit:</strong> $${d.totalProfit.toLocaleString()}<br/>
                        <strong>Bets:</strong> ${d.bets} | <strong>Wins:</strong> ${d.wins} | <strong>Losses:</strong> ${d.losses}<br/>
                        <strong>Win Rate:</strong> ${d.winRate.toFixed(1)}%<br/>
                        <strong>Avg Odds:</strong> ${d.averageOdds.toFixed(2)}<br/>
                        <em>Click for detailed breakdown</em>
                    `);
            }
            
            hideTooltip() {
                this.tooltip.style("display", "none");
            }
            
            setupModal() {
                const modal = document.getElementById('pattern-modal');
                const closeBtn = document.getElementById('modal-close');
                
                // Close modal when clicking X
                closeBtn.addEventListener('click', () => {
                    modal.style.display = 'none';
                });
                
                // Close modal when clicking outside
                window.addEventListener('click', (event) => {
                    if (event.target === modal) {
                        modal.style.display = 'none';
                    }
                });
                
                // Close modal on Escape key
                document.addEventListener('keydown', (event) => {
                    if (event.key === 'Escape' && modal.style.display === 'block') {
                        modal.style.display = 'none';
                    }
                });
            }
            
            showPatternDetails(d) {
                console.log('üìä Pattern Details:', d);
                
                const modal = document.getElementById('pattern-modal');
                const title = document.getElementById('modal-title');
                const subtitle = document.getElementById('modal-subtitle');
                const body = document.getElementById('modal-body');
                
                // Set title and subtitle
                title.textContent = d.name.replace(/_/g, ' ‚Üí ');
                subtitle.textContent = `ROI: ${d.roi.toFixed(2)}% | ${d.bets} bets | ${d.winRate.toFixed(1)}% win rate`;
                
                // Build detailed content
                const stakePerBet = d.totalStake / d.bets;
                const expectedWinnings = d.wins * d.averageOdds * stakePerBet;
                const actualProfit = d.totalPayout - d.totalStake;
                
                // Parse strategy factors
                const factors = d.name.split('_');
                let factorExplanations = factors.map(factor => {
                    if (factor.startsWith('time-')) {
                        const timing = factor.replace('time-', '');
                        return `üïê <strong>Timing:</strong> ${timing} (specific season period)`;
                    } else if (factor.startsWith('homeAway-')) {
                        const side = factor.replace('homeAway-', '');
                        return `üè† <strong>Bet Side:</strong> ${side} team`;
                    } else if (factor.startsWith('ahLevel-')) {
                        const level = factor.replace('ahLevel-', '');
                        return `‚öñÔ∏è <strong>Handicap:</strong> ${level} (Asian Handicap line)`;
                    } else if (factor.startsWith('oddsLevel-')) {
                        const level = factor.replace('oddsLevel-', '');
                        return `üéØ <strong>Odds Level:</strong> ${level} (betting odds range)`;
                    } else if (factor.startsWith('context-')) {
                        const context = factor.replace('context-', '');
                        return `üìä <strong>Context:</strong> ${context} (team/match situation)`;
                    } else if (factor.startsWith('handicapType-')) {
                        const type = factor.replace('handicapType-', '');
                        return `üìã <strong>Handicap Type:</strong> ${type}`;
                    } else if (factor.startsWith('matchUp-')) {
                        const matchup = factor.replace('matchUp-', '');
                        return `‚öîÔ∏è <strong>Match-up:</strong> ${matchup}`;
                    }
                    return `üìå <strong>Factor:</strong> ${factor}`;
                });
                
                body.innerHTML = `
                    <!-- Performance Summary -->
                    <div class="detail-section">
                        <h3>üìà Performance Summary</h3>
                        <div class="detail-grid">
                            <div class="detail-item">
                                <div class="detail-label">Return on Investment</div>
                                <div class="detail-value" style="color: ${d.roi > 0 ? '#2e7d32' : '#d32f2f'}; font-weight: bold; font-size: 24px;">
                                    ${d.roi.toFixed(2)}%
                                </div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Total Profit</div>
                                <div class="detail-value" style="color: ${d.totalProfit > 0 ? '#2e7d32' : '#d32f2f'}; font-weight: bold;">
                                    $${d.totalProfit.toLocaleString()}
                                </div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Win Rate</div>
                                <div class="detail-value">${d.winRate.toFixed(1)}%</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Average Odds</div>
                                <div class="detail-value">${d.averageOdds.toFixed(2)}</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Betting Statistics -->
                    <div class="detail-section">
                        <h3>üéØ Betting Statistics</h3>
                        <div class="detail-grid">
                            <div class="detail-item">
                                <div class="detail-label">Total Bets</div>
                                <div class="detail-value">${d.bets}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Wins</div>
                                <div class="detail-value" style="color: #2e7d32;">${d.wins}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Losses</div>
                                <div class="detail-value" style="color: #d32f2f;">${d.losses}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Pushes</div>
                                <div class="detail-value">${d.pushes}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Stake per Bet</div>
                                <div class="detail-value">$${stakePerBet.toFixed(0)}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Total Staked</div>
                                <div class="detail-value">$${d.totalStake.toLocaleString()}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Total Payout</div>
                                <div class="detail-value">$${d.totalPayout.toLocaleString()}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Net Profit</div>
                                <div class="detail-value" style="color: ${d.totalProfit > 0 ? '#2e7d32' : '#d32f2f'};">
                                    $${d.totalProfit.toLocaleString()}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Strategy Factors -->
                    <div class="detail-section strategy-factors">
                        <h3>üß† Strategy Factors</h3>
                        <p><strong>This pattern triggers when ALL of the following conditions are met:</strong></p>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            ${factorExplanations.map(explanation => `<li style="margin: 8px 0;">${explanation}</li>`).join('')}
                        </ul>
                        <p style="margin-top: 15px; padding: 10px; background: #e3f2fd; border-radius: 4px; font-size: 14px;">
                            üí° <strong>Strategy Logic:</strong> This combination of factors creates a betting opportunity where the ${d.name.includes('homeAway-away') ? 'away' : 'home'} team ${d.roi > 0 ? 'tends to outperform expectations' : 'underperforms'}, 
                            resulting in ${d.roi > 0 ? 'profitable' : 'losing'} betting outcomes.
                        </p>
                    </div>
                    
                    <!-- Calculation Breakdown -->
                    <div class="detail-section calculation-breakdown">
                        <h3>üßÆ Calculation Verification</h3>
                        <div style="background: white; padding: 15px; border-radius: 4px; border: 1px solid #e0e0e0;">
                            <h4 style="margin: 0 0 10px 0;">Step-by-Step Calculation:</h4>
                            <div style="font-family: monospace; font-size: 14px; line-height: 1.6;">
                                <div>üìä <strong>Betting Summary:</strong></div>
                                <div style="margin-left: 20px;">
                                    ‚Ä¢ ${d.bets} total bets at $${stakePerBet.toFixed(0)} each = $${d.totalStake.toLocaleString()} total stake
                                </div>
                                <div style="margin-left: 20px;">
                                    ‚Ä¢ ${d.wins} wins at avg ${d.averageOdds.toFixed(2)} odds = $${d.totalPayout.toLocaleString()} total payout
                                </div>
                                <div style="margin-left: 20px;">
                                    ‚Ä¢ ${d.losses} losses = $0 returned
                                </div>
                                <br/>
                                <div>üí∞ <strong>Profit Calculation:</strong></div>
                                <div style="margin-left: 20px;">
                                    ‚Ä¢ Net Profit = Total Payout - Total Stake
                                </div>
                                <div style="margin-left: 20px;">
                                    ‚Ä¢ Net Profit = $${d.totalPayout.toLocaleString()} - $${d.totalStake.toLocaleString()} = $${actualProfit.toLocaleString()}
                                </div>
                                <br/>
                                <div>üìà <strong>ROI Calculation:</strong></div>
                                <div style="margin-left: 20px;">
                                    ‚Ä¢ ROI = (Net Profit √∑ Total Stake) √ó 100
                                </div>
                                <div style="margin-left: 20px;">
                                    ‚Ä¢ ROI = ($${actualProfit.toLocaleString()} √∑ $${d.totalStake.toLocaleString()}) √ó 100 = ${d.roi.toFixed(2)}%
                                </div>
                            </div>
                            
                            <div style="margin-top: 15px; padding: 10px; background: #fff3cd; border-radius: 4px; font-size: 13px;">
                                ‚ö†Ô∏è <strong>Simulation Note:</strong> These calculations assume $${stakePerBet.toFixed(0)} per bet. 
                                For real betting with $10-20 stakes, divide all dollar amounts by ${Math.round(stakePerBet/15)}-${Math.round(stakePerBet/10)}.
                                ROI percentages remain the same regardless of stake size.
                            </div>
                        </div>
                    </div>
                    
                    <!-- Statistical Significance -->
                    <div class="detail-section">
                        <h3>üìä Statistical Analysis</h3>
                        <div class="detail-grid">
                            <div class="detail-item">
                                <div class="detail-label">Sample Size</div>
                                <div class="detail-value" style="color: ${d.bets >= 30 ? '#2e7d32' : d.bets >= 10 ? '#ff9800' : '#d32f2f'}">
                                    ${d.bets} bets ${d.bets >= 30 ? '‚úì' : d.bets >= 10 ? '‚ö†Ô∏è' : '‚ùå'}
                                </div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Reliability</div>
                                <div class="detail-value">
                                    ${d.bets >= 30 ? 'High' : d.bets >= 10 ? 'Medium' : 'Low'}
                                </div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Win Rate Consistency</div>
                                <div class="detail-value" style="color: ${d.winRate === 100 && d.bets < 20 ? '#d32f2f' : '#2e7d32'}">
                                    ${d.winRate === 100 && d.bets < 20 ? 'Suspicious' : 'Normal'}
                                </div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Confidence Level</div>
                                <div class="detail-value">
                                    ${d.bets >= 30 ? '85%+' : d.bets >= 10 ? '70%' : '<60%'}
                                </div>
                            </div>
                        </div>
                        
                        ${d.bets < 20 ? `
                            <div style="margin-top: 10px; padding: 10px; background: #ffebee; border-radius: 4px; color: #c62828; font-size: 14px;">
                                ‚ö†Ô∏è <strong>Small Sample Warning:</strong> This pattern has only ${d.bets} bets. Results may not be statistically significant. 
                                Recommend waiting for at least 20-30 bets before considering this pattern reliable.
                            </div>
                        ` : ''}
                        
                        ${d.winRate === 100 && d.bets < 20 ? `
                            <div style="margin-top: 10px; padding: 10px; background: #fff3e0; border-radius: 4px; color: #ef6c00; font-size: 14px;">
                                üö® <strong>Perfect Win Rate Alert:</strong> 100% win rate with small sample size is highly unusual. 
                                This may be due to cherry-picked data or luck. Expect win rate to decrease with more bets.
                            </div>
                        ` : ''}
                    </div>
                `;
                
                modal.style.display = 'block';
            }
            
            updateTable() {
                const tableBody = document.getElementById('table-body');
                tableBody.innerHTML = '';
                
                this.filteredData.forEach((pattern, index) => {
                    const row = document.createElement('tr');
                    
                    // Add hover effect and alternating row colors
                    row.style.backgroundColor = index % 2 === 0 ? '#ffffff' : '#f9f9f9';
                    row.style.transition = 'background-color 0.2s';
                    row.addEventListener('mouseenter', () => {
                        row.style.backgroundColor = '#e3f2fd';
                    });
                    row.addEventListener('mouseleave', () => {
                        row.style.backgroundColor = index % 2 === 0 ? '#ffffff' : '#f9f9f9';
                    });
                    
                    // Color code based on performance
                    let roiColor = '#000';
                    if (pattern.roi > 50) roiColor = '#2e7d32';
                    else if (pattern.roi > 20) roiColor = '#388e3c';
                    else if (pattern.roi > 0) roiColor = '#1976d2';
                    else if (pattern.roi >= -5) roiColor = '#ff9800';
                    else roiColor = '#d32f2f';
                    
                    const stakePerBet = pattern.totalStake / pattern.bets;
                    
                    row.innerHTML = `
                        <td style="padding: 8px; border-bottom: 1px solid #eee; font-weight: bold;">${index + 1}</td>
                        <td style="padding: 8px; border-bottom: 1px solid #eee; max-width: 250px; word-wrap: break-word;">
                            ${pattern.name.replace(/_/g, ' ‚Üí ')}
                        </td>
                        <td style="padding: 8px; border-bottom: 1px solid #eee; text-align: right; font-weight: bold; color: ${roiColor};">
                            ${pattern.roi.toFixed(2)}%
                        </td>
                        <td style="padding: 8px; border-bottom: 1px solid #eee; text-align: right;">${pattern.bets}</td>
                        <td style="padding: 8px; border-bottom: 1px solid #eee; text-align: right; color: #2e7d32;">${pattern.wins}</td>
                        <td style="padding: 8px; border-bottom: 1px solid #eee; text-align: right; color: #d32f2f;">${pattern.losses}</td>
                        <td style="padding: 8px; border-bottom: 1px solid #eee; text-align: right;">${pattern.winRate.toFixed(1)}%</td>
                        <td style="padding: 8px; border-bottom: 1px solid #eee; text-align: right;">${pattern.averageOdds.toFixed(2)}</td>
                        <td style="padding: 8px; border-bottom: 1px solid #eee; text-align: right;">$${pattern.totalStake.toLocaleString()}</td>
                        <td style="padding: 8px; border-bottom: 1px solid #eee; text-align: right;">$${pattern.totalPayout.toLocaleString()}</td>
                        <td style="padding: 8px; border-bottom: 1px solid #eee; text-align: right; font-weight: bold; color: ${roiColor};">
                            $${pattern.totalProfit.toLocaleString()}
                        </td>
                        <td style="padding: 8px; border-bottom: 1px solid #eee; text-align: right;">$${stakePerBet.toFixed(0)}</td>
                    `;
                    
                    // Add click handler for row
                    row.style.cursor = 'pointer';
                    row.addEventListener('click', () => this.showPatternDetails(pattern));
                    
                    tableBody.appendChild(row);
                });
                
                // Show warning for unrealistic data
                if (this.filteredData.length > 0) {
                    const warningRow = document.createElement('tr');
                    warningRow.innerHTML = `
                        <td colspan="12" style="padding: 15px; background: #fff3cd; border: 1px solid #ffeaa7; text-align: center; font-style: italic; color: #856404;">
                            ‚ö†Ô∏è <strong>Important:</strong> These are simulation results using $100 per bet. 
                            Many patterns show 100% win rates with small sample sizes (1-20 bets). 
                            Real betting would use lower stakes and expect more losses.
                            <br/>
                            <small>For realistic profit estimates, divide all dollar amounts by 5-10 for typical betting stakes.</small>
                        </td>
                    `;
                    tableBody.appendChild(warningRow);
                }
            }
        }
        
        // Initialize the chart
        new BarChart();
    </script>
</body>
</html> 
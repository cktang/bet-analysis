<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asian Handicap Factor Drilling - Pre-computed</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #0d1117;
            color: #c9d1d9;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
        }

        .header h1 {
            color: #f0f6fc;
            margin-bottom: 5px;
        }

        .header p {
            color: #8b949e;
            margin: 0;
        }

        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s;
        }

        .reset-btn {
            background: #da3633;
            color: white;
        }

        .reset-btn:hover {
            background: #b52727;
        }

        .filter-controls {
            background: #21262d;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }

        .filter-row {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-group label {
            font-size: 12px;
            color: #8b949e;
            min-width: 80px;
        }

        .filter-group select, .filter-group input {
            background: #0d1117;
            border: 1px solid #30363d;
            color: #c9d1d9;
            padding: 6px 10px;
            border-radius: 4px;
            font-size: 12px;
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            background: #0d1117;
            border-radius: 6px;
            overflow: hidden;
            border: 1px solid #30363d;
        }

        .results-table th {
            background: #161b22;
            padding: 12px 8px;
            text-align: left;
            border-bottom: 1px solid #30363d;
            font-size: 12px;
            color: #f0f6fc;
            font-weight: 600;
        }

        .results-table td {
            padding: 10px 8px;
            border-bottom: 1px solid #21262d;
            font-size: 11px;
            vertical-align: top;
        }

        .results-table tr:hover {
            background: #161b22;
        }

        .factor-combination {
            font-weight: 600;
            color: #58a6ff;
            margin-bottom: 4px;
        }

        .combination-type {
            font-size: 10px;
            color: #8b949e;
            text-transform: uppercase;
        }

        .roi-positive {
            color: #3fb950;
            font-weight: bold;
        }

        .roi-negative {
            color: #f85149;
            font-weight: bold;
        }

        .roi-neutral {
            color: #f0f6fc;
            font-weight: bold;
        }

        .stats-cell {
            text-align: center;
        }

        .strategy-list {
            max-height: 100px;
            overflow-y: auto;
            font-size: 10px;
            color: #8b949e;
        }

        .strategy-item {
            margin: 2px 0;
            padding: 2px 4px;
            background: #21262d;
            border-radius: 2px;
        }

        .no-results {
            text-align: center;
            padding: 40px;
            color: #8b949e;
        }

        .stats-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: #161b22;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #30363d;
        }

        .stat-card h3 {
            margin: 0 0 8px 0;
            font-size: 14px;
            color: #f0f6fc;
        }

        .stat-value {
            font-size: 20px;
            font-weight: bold;
            color: #58a6ff;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #8b949e;
        }

        .type-single_exact { background: #065f46; }
        .type-small_group { background: #1f2937; }
        .type-aggregate { background: #374151; }
        .type-too_broad { background: #451a03; }
    </style>
</head>
<body>
    <div class="container">
                    <div class="header">
                <h1>üéØ Asian Handicap Factor Drilling - Comprehensive Analysis</h1>
                <p>Complete analysis of 2,646 meaningful factor combinations from 20,384 strategies</p>
            </div>

        <div id="loading" class="loading">
            Loading pre-computed analysis...
        </div>

        <div id="content" style="display: none;">
            <div class="stats-summary" id="statsSummary">
                <!-- Stats will be populated -->
            </div>

            <div class="filter-controls">
                <div class="filter-row">
                    <div class="filter-group">
                        <label>Type:</label>
                        <select id="typeFilter">
                            <option value="">All Types</option>
                            <option value="aggregate">‚úÖ Aggregates (11-100 strategies)</option>
                            <option value="small_group">üéØ Small Groups (‚â§10 strategies)</option>
                            <option value="single_exact">‚≠ê Single Strategies</option>
                            <option value="too_broad">‚ö†Ô∏è Too Broad (>100 strategies)</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Min ROI:</label>
                        <input type="number" id="roiFilter" placeholder="0" step="1" min="-100" max="100">
                    </div>
                    <div class="filter-group">
                        <label>Min Bets:</label>
                        <input type="number" id="betsFilter" placeholder="0" step="100" min="0">
                    </div>
                    <div class="filter-group">
                        <label>Factors:</label>
                        <select id="factorCountFilter">
                            <option value="">Any Count</option>
                            <option value="1">1 Factor</option>
                            <option value="2">2 Factors</option>
                            <option value="3">3 Factors</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <button class="btn reset-btn" onclick="resetFilters()">Reset Filters</button>
                    </div>
                </div>
            </div>

            <table class="results-table" id="resultsTable">
                <thead>
                    <tr>
                        <th style="width: 300px;">Factor Combination</th>
                        <th style="width: 80px;">Type</th>
                        <th style="width: 80px;">Patterns</th>
                        <th style="width: 80px;">ROI %</th>
                        <th style="width: 100px;">Total Bets</th>
                        <th style="width: 120px;">Total Profit</th>
                        <th>Top Strategies / Notes</th>
                    </tr>
                </thead>
                <tbody id="resultsBody">
                    <!-- Results will be populated -->
                </tbody>
            </table>

            <div id="noResults" class="no-results" style="display: none;">
                No combinations match the current filters.
            </div>
        </div>
    </div>

    <script>
        let allResults = [];
        let filteredResults = [];
        let data = {};

        async function init() {
            try {
                const response = await fetch('../results/comprehensive_combinations_analysis.json');
                data = await response.json();
                
                allResults = data.allResults;
                
                displayStats(data.summary);
                applyFilters();
                
                document.getElementById('loading').style.display = 'none';
                document.getElementById('content').style.display = 'block';
                
                // Add event listeners
                document.getElementById('typeFilter').addEventListener('change', applyFilters);
                document.getElementById('roiFilter').addEventListener('input', applyFilters);
                document.getElementById('betsFilter').addEventListener('input', applyFilters);
                document.getElementById('factorCountFilter').addEventListener('change', applyFilters);
                
            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('loading').innerHTML = 
                    `<div style="color: #f85149;">Error loading analysis data: ${error.message}</div>`;
            }
        }

        function displayStats(summary) {
            const statsContainer = document.getElementById('statsSummary');
            
            statsContainer.innerHTML = `
                <div class="stat-card">
                    <h3>Total Combinations</h3>
                    <div class="stat-value">${summary.total.toLocaleString()}</div>
                </div>
                <div class="stat-card">
                    <h3>Useful Aggregates</h3>
                    <div class="stat-value">${summary.byType.aggregate || 0}</div>
                </div>
                <div class="stat-card">
                    <h3>Small Groups</h3>
                    <div class="stat-value">${summary.byType.small_group || 0}</div>
                </div>
                <div class="stat-card">
                    <h3>Single Strategies</h3>
                    <div class="stat-value">${summary.byType.single_exact || 0}</div>
                </div>
                <div class="stat-card">
                    <h3>Too Broad</h3>
                    <div class="stat-value">${summary.byType.too_broad || 0}</div>
                </div>
                <div class="stat-card">
                    <h3>Best ROI</h3>
                    <div class="stat-value">${Math.max(
                        summary.bestAggregates[0]?.roi || 0,
                        summary.bestSmallGroups[0]?.roi || 0,
                        summary.bestSingleStrategies[0]?.roi || 0
                    ).toFixed(1)}%</div>
                </div>
            `;
        }

        function applyFilters() {
            const typeFilter = document.getElementById('typeFilter').value;
            const roiFilter = parseFloat(document.getElementById('roiFilter').value) || -Infinity;
            const betsFilter = parseInt(document.getElementById('betsFilter').value) || 0;
            const factorCountFilter = document.getElementById('factorCountFilter').value;

            filteredResults = allResults.filter(result => {
                if (typeFilter && result.type !== typeFilter) return false;
                if (result.roi < roiFilter) return false;
                if (result.bets < betsFilter) return false;
                if (factorCountFilter && result.combination.length !== parseInt(factorCountFilter)) return false;
                return true;
            });

            // Sort by ROI descending
            filteredResults.sort((a, b) => (b.roi || 0) - (a.roi || 0));

            displayResults();
        }

        function displayResults() {
            const tbody = document.getElementById('resultsBody');
            const noResults = document.getElementById('noResults');

            if (filteredResults.length === 0) {
                tbody.innerHTML = '';
                noResults.style.display = 'block';
                return;
            }

            noResults.style.display = 'none';

            tbody.innerHTML = filteredResults.map(result => {
                const roiClass = result.roi > 0 ? 'roi-positive' : result.roi < 0 ? 'roi-negative' : 'roi-neutral';
                const typeClass = `type-${result.type}`;
                
                // Convert factor keys to readable names using factorDefinitions
                let factorNames;
                if (typeof result.factors === 'string') {
                    factorNames = result.factors; // Already formatted
                } else if (Array.isArray(result.factors)) {
                    // Convert factor keys to names using data.factorDefinitions
                    factorNames = result.factors.map(f => {
                        const def = data.factorDefinitions?.[f];
                        return def ? def.name : f;
                    }).join(' + ');
                } else {
                    factorNames = 'Unknown';
                }
                
                let detailsHTML = '';
                if (result.type === 'single_exact' && result.strategy) {
                    detailsHTML = `
                        <div class="strategy-list">
                            <div class="strategy-item"><strong>Exact:</strong> ${result.strategy.name}</div>
                        </div>
                    `;
                } else if (result.type === 'small_group' && result.representative) {
                    detailsHTML = `
                        <div class="strategy-list">
                            <div class="strategy-item"><strong>Best:</strong> ${result.representative.name} (${result.representative.roi.toFixed(1)}% ROI)</div>
                            <div style="color: #8b949e; font-size: 9px; margin-top: 2px;">${result.patterns} strategies in group</div>
                        </div>
                    `;
                } else if (result.type === 'aggregate' && result.topStrategies) {
                    detailsHTML = `
                        <div class="strategy-list">
                            ${result.topStrategies.slice(0, 3).map(s => 
                                `<div class="strategy-item">${s.name} (${s.roi.toFixed(1)}% ROI, ${s.bets} bets)</div>`
                            ).join('')}
                            ${result.topStrategies.length > 3 ? 
                                `<div style="color: #8b949e; font-size: 9px;">...and ${result.patterns - 3} more</div>` : ''}
                        </div>
                    `;
                } else if (result.note) {
                    detailsHTML = `<div style="color: #8b949e; font-size: 10px;">${result.note}</div>`;
                }

                return `
                    <tr class="${typeClass}">
                        <td>
                            <div class="factor-combination">${factorNames}</div>
                            <div class="combination-type">${result.size || result.combination?.length || 0} factors</div>
                        </td>
                        <td>
                            <span class="combination-type">${result.type.replace('_', ' ')}</span>
                        </td>
                        <td class="stats-cell">${result.patterns.toLocaleString()}</td>
                        <td class="stats-cell">
                            <span class="${roiClass}">${(result.roi || 0).toFixed(2)}%</span>
                        </td>
                        <td class="stats-cell">${result.bets.toLocaleString()}</td>
                        <td class="stats-cell">
                            <span class="${roiClass}">$${(result.profit || 0).toLocaleString()}</span>
                        </td>
                        <td>${detailsHTML}</td>
                    </tr>
                `;
            }).join('');
        }

        function resetFilters() {
            document.getElementById('typeFilter').value = '';
            document.getElementById('roiFilter').value = '';
            document.getElementById('betsFilter').value = '';
            document.getElementById('factorCountFilter').value = '';
            applyFilters();
        }

        // Initialize
        init();
    </script>
</body>
</html> 